<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura do Quebra-Cabeça</title>

    <style>
        /* Estilos Gerais */
        body {
            font-family: sans-serif;
            margin: 0;
            background-color: #f0f8ff; /* Azul bem claro */
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Garante que o body ocupe toda a altura da viewport */
        }

        * {
            box-sizing: border-box;
        }

        /* Cabeçalho */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #ffffff;
            border-bottom: 2px solid #ddd;
        }
        .header-emblem, .header-logo {
            height: 60px;
        }
        .game-title {
            font-family: 'Arial Black', sans-serif; /* Fonte impactante */
            font-size: 2em; /* Tamanho do título */
            color: #4CAF50; /* Verde vibrante */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3); /* Sombra para destaque */
            margin: 0 20px; /* Espaçamento lateral */
            white-space: nowrap; /* Evita que o título quebre linha */
        }

        /* Layout Principal */
        .container-principal {
            display: flex;
            flex-grow: 1; /* Permite que este container ocupe o espaço restante */
            padding: 20px;
            gap: 20px; /* Adiciona espaço entre a barra lateral e a área do jogo */
            align-items: flex-start; /* Alinha os itens ao topo do container */
            justify-content: center; /* Centraliza o conteúdo horizontalmente, mantendo o tabuleiro no centro */
            overflow-y: auto; /* Adiciona rolagem se o conteúdo for muito alto */
        }

        /* Barra Lateral */
        .barra-lateral {
            width: 220px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex-shrink: 0;
        }

        /* Estilo para a imagem de referência */
        .imagem-referencia {
            width: 100%;
            border-radius: 5px;
            border: 2px solid #ccc;
            margin-bottom: 15px;
        }

        /* Container para alinhar Imagem do Jogador, Placar e Botão */
        .container-info-jogador {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%; /* Garante que o container ocupe a largura disponível na barra lateral */
            margin-bottom: 20px; /* Espaço abaixo deste bloco */
        }

        /* Estilo para a imagem do jogador (avatar) */
        .avatar-jogador {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #007bff;
            margin-bottom: 15px;
            object-fit: cover; /* Garante que a imagem preencha o círculo */
            transition: border-color 0.3s ease, box-shadow 0.3s ease; /* Transição para o efeito de desbloqueio */
        }

        .avatar-jogador.unlocked {
            border-color: #ffd700; /* Cor dourada para selo desbloqueado */
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7); /* Sombra dourada */
        }

        .placar {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .placar p {
            margin: 5px 0;
        }
        #botao-reiniciar {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        #botao-reiniciar:hover {
            background-color: #c82333;
        }

        /* Área de Trabalho (Quebra-Cabeça) */
        .area-trabalho {
            display: flex;
            flex-direction: row; /* Mantém o tabuleiro e as peças um ao lado do outro */
            gap: 20px;
            flex-grow: 1;
            max-width: unset; /* Remove restrições de max-width aqui */
            margin: 0;
            justify-content: center; /* Centraliza o tabuleiro e as peças */
            align-items: flex-start;
        }
        #tabuleiro-quebra-cabeca {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(5, 1fr);
            border: 2px solid #333;
            /* Tamanho Fixo para o tabuleiro (pode ser ajustado para ser mais responsivo) */
            width: 800px; /* Largura fixa */
            height: 500px; /* Altura fixa (800px / (8/5) = 500px) */
            background-color: #ddd;
            flex-shrink: 0; /* Impede que o tabuleiro encolha */
        }
        .espaco-peca {
            border: 1px solid #ccc;
        }
        #container-pecas {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Peças em 3 colunas */
            gap: 5px;
            padding: 10px;
            background-color: #e0e0e0;
            border-radius: 8px;
            align-items: start; /* Alinha as peças ao topo dentro do container */
            justify-items: center; /* Centraliza as peças horizontalmente em suas células */
            width: auto; /* Deixa a largura ser determinada pelo conteúdo das 3 colunas e gap */
            max-width: 350px; /* Um pouco mais de largura para as 3 colunas + gap */
            flex-shrink: 0;
            overflow-y: auto; /* Permite rolagem vertical se houver muitas peças */
            max-height: 500px; /* Ajusta a altura máxima para a altura do tabuleiro */
        }
        .peca-quebra-cabeca {
            background-image: url('onça.png');
            border: 1px solid #000;
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
            /* width e height serão definidos via JS para corresponder ao tabuleiro */
            /* background-size e background-position serão definidos via JS para corresponder ao tabuleiro */
        }
        .peca-quebra-cabeca:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 10;
        }

        /* Rodapé */
        footer {
            padding: 15px 20px;
            text-align: center;
            background-color: #ffffff;
            border-top: 2px solid #ddd;
            flex-shrink: 0; /* Impede que o rodapé encolha e garante que fique sempre no final */
        }
        .caixa-mensagem-mapa a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Janela Modal de Conclusão */
        .overlay-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .conteudo-modal {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            color: #28a745;
            border: 5px solid #28a745;
            max-width: 90%;
            width: 500px;
        }
        .conteudo-modal h2 {
            font-size: 2.2em;
            margin-top: 0;
        }
        .conteudo-modal p {
            color: #333;
            font-size: 1.2em;
        }
        .selo-ganho {
            width: 100px;
            height: 100px;
            margin: 20px 0;
            animation: pulse 1.5s infinite;
        }
        .botao-voltar {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1.2em;
            margin-top: 20px;
            border: none;
        }
        .botao-voltar:hover {
            background-color: #0056b3;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Estilos para o Modal de Boas-Vindas */
        .modal-info {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Maior que o modal de conclusão */
        }

        .conteudo-modal-info {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 90%;
            width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 2px solid #007bff;
        }
        .conteudo-modal-info h2 {
            color: #007bff;
            font-size: 2em;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .conteudo-modal-info p {
            color: #333;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .conteudo-modal-info ul {
            text-align: left;
            margin: 0 auto 20px;
            padding-left: 25px;
            max-width: 80%;
            color: #444;
        }
        .conteudo-modal-info ul li {
            margin-bottom: 10px;
        }
        .botao-fechar-modal {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        .botao-fechar-modal:hover {
            background-color: #0056b3;
        }

        /* Responsividade */
        @media (max-width: 1024px) {
            .container-principal {
                flex-direction: column;
                align-items: center;
            }
            .barra-lateral {
                width: 90%;
                max-width: 400px;
            }
            .area-trabalho {
                flex-direction: column;
                align-items: center;
            }
            #tabuleiro-quebra-cabeca {
                width: 90%; /* Ajusta para 90% da largura da tela */
                height: auto;
                aspect-ratio: 8 / 5; /* Mantém a proporção */
            }
            #container-pecas {
                width: 90%;
                max-width: 90%;
                /* Ajuste para 4 colunas em telas médias, com tamanho mínimo maior */
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); /* Aumenta o minmax */
                max-height: none; /* Remove altura máxima para rolagem em telas menores */
            }
            .peca-quebra-cabeca {
                width: 100%; /* Peças se ajustam à largura da coluna */
                height: auto;
                aspect-ratio: 1 / 1; /* Mantém as peças quadradas */
            }
            .game-title {
                font-size: 1.8em;
            }
            .conteudo-modal-info h2, .conteudo-modal h2 {
                font-size: 1.8em;
            }
            .conteudo-modal-info p, .conteudo-modal p {
                font-size: 1em;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 10px;
            }
            .game-title {
                font-size: 1.5em;
                margin-top: 10px;
                margin-bottom: 5px;
            }
            .header-emblem, .header-logo {
                height: 50px;
            }
            .container-principal {
                padding: 10px;
                gap: 15px;
            }
            .barra-lateral {
                padding: 15px;
            }
            .avatar-jogador {
                width: 80px;
                height: 80px;
            }
            .placar {
                font-size: 1em;
            }
            #botao-reiniciar {
                padding: 8px;
                font-size: 0.9em;
            }
            #tabuleiro-quebra-cabeca {
                width: 95%; /* Continua ajustando a largura */
            }
            #container-pecas {
                width: 95%;
                padding: 8px;
                gap: 5px; /* Aumenta o gap para melhor espaçamento */
                /* Ajuste para 3 colunas em telas menores, com tamanho mínimo maior */
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); /* Aumenta o minmax */
            }
            .conteudo-modal-info, .conteudo-modal {
                padding: 20px;
            }
            .conteudo-modal-info h2, .conteudo-modal h2 {
                font-size: 1.5em;
            }
            .conteudo-modal-info p, .conteudo-modal p {
                font-size: 0.9em;
            }
            .conteudo-modal-info ul {
                padding-left: 20px;
                max-width: 90%;
            }
            .selo-ganho {
                width: 80px;
                height: 80px;
            }
            .botao-voltar {
                padding: 10px 20px;
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            .game-title {
                font-size: 1.2em;
            }
            .header-emblem, .header-logo {
                height: 40px;
            }
            .barra-lateral {
                padding: 10px;
            }
            .avatar-jogador {
                width: 70px;
                height: 70px;
            }
            .placar {
                font-size: 0.9em;
            }
            #botao-reiniciar {
                padding: 6px;
                font-size: 0.8em;
            }
            #container-pecas {
                /* Ajuste para 2 ou 3 colunas em telas muito pequenas, com tamanho mínimo bem maior */
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); /* Aumenta bastante para peças maiores */
                gap: 8px; /* Mais espaço entre as peças */
                padding: 15px; /* Mais padding no container das peças */
            }
            .conteudo-modal-info h2, .conteudo-modal h2 {
                font-size: 1.3em;
            }
            .conteudo-modal-info p, .conteudo-modal p {
                font-size: 0.8em;
            }
            .conteudo-modal-info ul {
                padding-left: 15px;
            }
            .botao-fechar-modal {
                padding: 8px 15px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    ```

**Principais alterações no CSS:**

* **`#tabuleiro-quebra-cabeca`**: Mudei o `width` para `90%` ou `95%` em telas menores. Isso fará com que o tabuleiro ocupe uma porcentagem da largura da tela, em vez de um valor fixo. O `aspect-ratio` garantirá que a altura se ajuste proporcionalmente.
* **`#container-pecas`**:
    * Para `@media (max-width: 1024px)`, aumentei `minmax(80px, 1fr)` para **`minmax(100px, 1fr)`** nas `grid-template-columns`. Isso força as peças a serem um pouco maiores.
    * Para `@media (max-width: 768px)`, ajustei o `gap` para `5px` e o `minmax` para **`minmax(80px, 1fr)`**.
    * Para `@media (max-width: 480px)`, o `minmax` foi aumentado significativamente para **`minmax(100px, 1fr)`** e o `gap` para `8px` para que as peças fiquem maiores e mais fáceis de tocar. Aumentei também o `padding` do container.
    * O `grid-template-columns: repeat(auto-fill, minmax(Xpx, 1fr))` é fundamental porque ele permite que o navegador decida quantas colunas são apropriadas com base no tamanho mínimo `Xpx` que você definiu para cada item, garantindo que as peças nunca fiquem menores que `Xpx`.
* **`.peca-quebra-cabeca`**: Mantive `width: 100%; height: auto; aspect-ratio: 1 / 1;` dentro das media queries. Isso é crucial porque faz com que cada peça ocupe 100% da largura da sua célula no grid e mantenha uma proporção quadrada, adaptando seu tamanho à largura da coluna definida no `#container-pecas`.

**2. Ajustes no JavaScript (dentro da tag `<script>`)**

A sua função `ajustarTamanhoDasPecas()` é fundamental para redimensionar as peças. Ela já usa `tabuleiro.clientWidth` e `tabuleiro.clientHeight` para calcular o tamanho das peças, o que é ótimo.

**O importante é garantir que essa função seja chamada sempre que o tamanho da tela mudar (o que você já faz com `window.addEventListener('resize', ajustarTamanhoDasPecas);`) e também após a inicialização do jogo para que as peças tenham o tamanho correto desde o início.**

No seu código, a linha `ajustarTamanhoDasPecas();` já está presente dentro de `inicializarJogo()`, o que é perfeito.

```javascript
            function inicializarJogo() {
                acertos = 0;
                erros = 0;
                atualizarPlacar();

                tabuleiro.innerHTML = '';
                containerPecas.innerHTML = '';
                modalConclusao.style.display = 'none';

                // Remova as linhas abaixo, pois o width/height do tabuleiro agora são responsivos pelo CSS
                // const larguraPeca = tabuleiro.clientWidth / COLUNAS;
                // const alturaPeca = tabuleiro.clientHeight / LINHAS;

                let pecas = [];
                for (let i = 0; i < TOTAL_PECAS; i++) {
                    const espaco = document.createElement('div');
                    espaco.classList.add('espaco-peca');
                    espaco.dataset.id = i;
                    tabuleiro.appendChild(espaco);

                    espaco.addEventListener('dragover', aoArrastarSobre);
                    espaco.addEventListener('drop', aoSoltar);

                    const peca = document.createElement('div');
                    peca.classList.add('peca-quebra-cabeca');
                    peca.dataset.id = i;
                    peca.draggable = true;

                    // O cálculo do background-position e background-size deve ser feito com base no tamanho original da imagem
                    // e no número de peças, não no clientWidth/Height do tabuleiro, que pode variar
                    // Isso garante que a imagem de fundo esteja sempre correta, independentemente do tamanho da peça no CSS.
                    // Para o background-size, você deve usar o tamanho real da imagem ou um tamanho relativo a ela.
                    // Se a imagem for de 800x500 e você tem 8x5 peças, então:
                    const originalImageWidth = 800; // Assumindo que 'onça.png' tem 800px de largura
                    const originalImageHeight = 500; // Assumindo que 'onça.png' tem 500px de altura
                    const pecaOriginalWidth = originalImageWidth / COLUNAS;
                    const pecaOriginalHeight = originalImageHeight / LINHAS;

                    const col = i % COLUNAS;
                    const lin = Math.floor(i / COLUNAS);

                    // Deixe o width e height da peça serem controlados apenas pelo CSS
                    // peca.style.width = `${larguraPeca}px`; // REMOVER
                    // peca.style.height = `${alturaPeca}px`; // REMOVER

                    peca.style.backgroundImage = `url('${NOME_IMAGEM_QUEBRA_CABECAS}')`;
                    peca.style.backgroundSize = `${originalImageWidth}px ${originalImageHeight}px`; // Tamanho total da imagem de fundo
                    peca.style.backgroundPosition = `-${col * pecaOriginalWidth}px -${lin * pecaOriginalHeight}px`; // Posição para mostrar o pedaço correto

                    peca.addEventListener('dragstart', aoArrastar);
                    pecas.push(peca);
                }

                pecas.sort(() => Math.random() - 0.5); // Embaralha as peças
                pecas.forEach(p => containerPecas.appendChild(p)); // Adiciona as peças ao container lateral

                // A função ajustarTamanhoDasPecas() que estava aqui não é mais necessária para o tamanho das peças em si,
                // pois o CSS as controla. Ela era mais para o background-size, que agora é fixo.
                // ajustarTamanhoDasPecas(); // REMOVER OU MANTER APENAS SE TIVER OUTRA LÓGICA DE AJUSTE QUE NÃO SEJA O BACKGROUND
                updatePlayerAvatarStatus(); // Atualiza o avatar ao reiniciar o jogo
            }

            // Esta função não é mais necessária para definir o width/height das peças,
            // mas ainda é útil para reajustar o background-size se o tabuleiro for elástico.
            // No entanto, se o background-size for o tamanho total da imagem, não precisa ser reajustado.
            // Se você quer que a imagem de fundo das peças se adapte ao tamanho do tabuleiro (que é responsivo),
            // você precisa recalcular o backgroundSize aqui também.
            function ajustarTamanhoDasPecas() {
                 // Reajustar o background-size para corresponder ao tabuleiro responsivo
                const larguraTabuleiroAtual = tabuleiro.clientWidth;
                const alturaTabuleiroAtual = tabuleiro.clientHeight;

                const todasAsPecas = document.querySelectorAll('.peca-quebra-cabeca');
                todasAsPecas.forEach(p => {
                    p.style.backgroundSize = `${larguraTabuleiroAtual}px ${alturaTabuleiroAtual}px`;
                    // O background-position já está correto se as coordenadas forem baseadas no tamanho original da imagem
                    // e a peça se dimensionar por CSS.
                });
            }
