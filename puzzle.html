<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura do Quebra-Cabeça</title>

    <style>
        /* Estilos Gerais */
        body {
            font-family: sans-serif;
            margin: 0;
            background-color: #f0f8ff; /* Azul bem claro */
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Garante que o body ocupe toda a altura da viewport */
        }

        * {
            box-sizing: border-box;
        }

        /* Cabeçalho */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #ffffff;
            border-bottom: 2px solid #ddd;
        }
        .header-emblem, .header-logo {
            height: 60px;
        }
        .game-title {
            font-family: 'Arial Black', sans-serif; /* Fonte impactante */
            font-size: 2em; /* Tamanho do título */
            color: #4CAF50; /* Verde vibrante */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3); /* Sombra para destaque */
            margin: 0 20px; /* Espaçamento lateral */
            white-space: nowrap; /* Evita que o título quebre linha */
        }

        /* Layout Principal */
        .container-principal {
            display: flex;
            flex-grow: 1; /* Permite que este container ocupe o espaço restante */
            padding: 20px;
            gap: 20px; /* Adiciona espaço entre a barra lateral e a área do jogo */
            align-items: flex-start; /* Alinha os itens ao topo do container */
            justify-content: center; /* Centraliza o conteúdo horizontalmente, mantendo o tabuleiro no centro */
            overflow-y: auto; /* Adiciona rolagem se o conteúdo for muito alto */
        }

        /* Barra Lateral */
        .barra-lateral {
            width: 220px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex-shrink: 0;
        }

        /* Estilo para a imagem de referência */
        .imagem-referencia {
            width: 100%;
            border-radius: 5px;
            border: 2px solid #ccc;
            margin-bottom: 15px;
        }

        /* Container para alinhar Imagem do Jogador, Placar e Botão */
        .container-info-jogador {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%; /* Garante que o container ocupe a largura disponível na barra lateral */
            margin-bottom: 20px; /* Espaço abaixo deste bloco */
        }

        /* Estilo para a imagem do jogador (avatar) */
        .avatar-jogador {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #007bff;
            margin-bottom: 15px;
            object-fit: cover; /* Garante que a imagem preencha o círculo */
            transition: border-color 0.3s ease, box-shadow 0.3s ease; /* Transição para o efeito de desbloqueio */
        }

        .avatar-jogador.unlocked {
            border-color: #ffd700; /* Cor dourada para selo desbloqueado */
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7); /* Sombra dourada */
        }

        .placar {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .placar p {
            margin: 5px 0;
        }
        #botao-reiniciar {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        #botao-reiniciar:hover {
            background-color: #c82333;
        }

        /* Área de Trabalho (Quebra-Cabeça) */
        .area-trabalho {
            display: flex;
            flex-direction: row; /* Mantém o tabuleiro e as peças um ao lado do outro */
            gap: 20px;
            flex-grow: 1;
            max-width: unset; /* Remove restrições de max-width aqui */
            margin: 0;
            justify-content: center; /* Centraliza o tabuleiro e as peças */
            align-items: flex-start;
        }
        #tabuleiro-quebra-cabeca {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(5, 1fr);
            border: 2px solid #333;
            /* Tamanho Fixo para o tabuleiro (pode ser ajustado para ser mais responsivo) */
            width: 800px; /* Largura fixa */
            height: 500px; /* Altura fixa (800px / (8/5) = 500px) */
            background-color: #ddd;
            flex-shrink: 0; /* Impede que o tabuleiro encolha */
        }
        .espaco-peca {
            border: 1px solid #ccc;
        }
        #container-pecas {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Peças em 3 colunas */
            gap: 5px;
            padding: 10px;
            background-color: #e0e0e0;
            border-radius: 8px;
            align-items: start; /* Alinha as peças ao topo dentro do container */
            justify-items: center; /* Centraliza as peças horizontalmente em suas células */
            width: auto; /* Deixa a largura ser determinada pelo conteúdo das 3 colunas e gap */
            max-width: 350px; /* Um pouco mais de largura para as 3 colunas + gap */
            flex-shrink: 0;
            overflow-y: auto; /* Permite rolagem vertical se houver muitas peças */
            max-height: 500px; /* Ajusta a altura máxima para a altura do tabuleiro */
        }
        .peca-quebra-cabeca {
            background-image: url('onça.png');
            border: 1px solid #000;
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
            /* width e height serão definidos via JS para corresponder ao tabuleiro */
            /* background-size e background-position serão definidos via JS para corresponder ao tabuleiro */
        }
        .peca-quebra-cabeca:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 10;
        }

        /* Rodapé */
        footer {
            padding: 15px 20px;
            text-align: center;
            background-color: #ffffff;
            border-top: 2px solid #ddd;
            flex-shrink: 0; /* Impede que o rodapé encolha e garante que fique sempre no final */
        }
        .caixa-mensagem-mapa a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Janela Modal de Conclusão */
        .overlay-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .conteudo-modal {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            color: #28a745;
            border: 5px solid #28a745;
            max-width: 90%;
            width: 500px;
        }
        .conteudo-modal h2 {
            font-size: 2.2em;
            margin-top: 0;
        }
        .conteudo-modal p {
            color: #333;
            font-size: 1.2em;
        }
        .selo-ganho {
            width: 100px;
            height: 100px;
            margin: 20px 0;
            animation: pulse 1.5s infinite;
        }
        .botao-voltar {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1.2em;
            margin-top: 20px;
            border: none;
        }
        .botao-voltar:hover {
            background-color: #0056b3;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Estilos para o Modal de Boas-Vindas */
        .modal-info {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Maior que o modal de conclusão */
        }

        .conteudo-modal-info {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 90%;
            width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 2px solid #007bff;
        }
        .conteudo-modal-info h2 {
            color: #007bff;
            font-size: 2em;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .conteudo-modal-info p {
            color: #333;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .conteudo-modal-info ul {
            text-align: left;
            margin: 0 auto 20px;
            padding-left: 25px;
            max-width: 80%;
            color: #444;
        }
        .conteudo-modal-info ul li {
            margin-bottom: 10px;
        }
        .botao-fechar-modal {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        .botao-fechar-modal:hover {
            background-color: #0056b3;
        }

        /* Responsividade */
        @media (max-width: 1024px) {
            .container-principal {
                flex-direction: column;
                align-items: center;
            }
            .barra-lateral {
                width: 90%;
                max-width: 400px;
            }
            .area-trabalho {
                flex-direction: column;
                align-items: center;
            }
            #tabuleiro-quebra-cabeca {
                width: 90%; /* Ajusta para 90% da largura da tela */
                height: auto;
                aspect-ratio: 8 / 5; /* Mantém a proporção */
            }
            #container-pecas {
                width: 90%;
                max-width: 90%;
                /* Ajuste para 4 colunas em telas médias, com tamanho mínimo maior */
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); /* Aumenta o minmax */
                max-height: none; /* Remove altura máxima para rolagem em telas menores */
            }
            .peca-quebra-cabeca {
                width: 100%; /* Peças se ajustam à largura da coluna */
                height: auto;
                aspect-ratio: 1 / 1; /* Mantém as peças quadradas */
            }
            .game-title {
                font-size: 1.8em;
            }
            .conteudo-modal-info h2, .conteudo-modal h2 {
                font-size: 1.8em;
            }
            .conteudo-modal-info p, .conteudo-modal p {
                font-size: 1em;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 10px;
            }
            .game-title {
                font-size: 1.5em;
                margin-top: 10px;
                margin-bottom: 5px;
            }
            .header-emblem, .header-logo {
                height: 50px;
            }
            .container-principal {
                padding: 10px;
                gap: 15px;
            }
            .barra-lateral {
                padding: 15px;
            }
            .avatar-jogador {
                width: 80px;
                height: 80px;
            }
            .placar {
                font-size: 1em;
            }
            #botao-reiniciar {
                padding: 8px;
                font-size: 0.9em;
            }
            #tabuleiro-quebra-cabeca {
                width: 95%; /* Continua ajustando a largura */
            }
            #container-pecas {
                width: 95%;
                padding: 8px;
                gap: 5px; /* Aumenta o gap para melhor espaçamento */
                /* Ajuste para 3 colunas em telas menores, com tamanho mínimo maior */
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); /* Aumenta o minmax */
            }
            .conteudo-modal-info, .conteudo-modal {
                padding: 20px;
            }
            .conteudo-modal-info h2, .conteudo-modal h2 {
                font-size: 1.5em;
            }
            .conteudo-modal-info p, .conteudo-modal p {
                font-size: 0.9em;
            }
            .conteudo-modal-info ul {
                padding-left: 20px;
                max-width: 90%;
            }
            .selo-ganho {
                width: 80px;
                height: 80px;
            }
            .botao-voltar {
                padding: 10px 20px;
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            .game-title {
                font-size: 1.2em;
            }
            .header-emblem, .header-logo {
                height: 40px;
            }
            .barra-lateral {
                padding: 10px;
            }
            .avatar-jogador {
                width: 70px;
                height: 70px;
            }
            .placar {
                font-size: 0.9em;
            }
            #botao-reiniciar {
                padding: 6px;
                font-size: 0.8em;
            }
            #container-pecas {
                /* Ajuste para 2 ou 3 colunas em telas muito pequenas, com tamanho mínimo bem maior */
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); /* Aumenta bastante para peças maiores */
                gap: 8px; /* Mais espaço entre as peças */
                padding: 15px; /* Mais padding no container das peças */
            }
            .conteudo-modal-info h2, .conteudo-modal h2 {
                font-size: 1.3em;
            }
            .conteudo-modal-info p, .conteudo-modal p {
                font-size: 0.8em;
            }
            .conteudo-modal-info ul {
                padding-left: 15px;
            }
            .botao-fechar-modal {
                padding: 8px 15px;
                font-size: 0.9em;
            }
        }
    </style>
    </head>
<body>

    <header>
        <img src="Capa.png" alt="Emblema do Jogo" class="header-emblem">
        <h1 class="game-title">Quebra-Cabeça</h1>
        <img src="logo.png" alt="Logo do Jogo" class="header-logo">
    </header>

    <div class="container-principal">
        <aside class="barra-lateral">
            <img src="puzzle.png" alt="Imagem de Referência" class="imagem-referencia">

            <div class="container-info-jogador">
                <img src="HPERS.png" alt="Figura do Jogador" class="avatar-jogador" id="playerAvatar">

                <div class="placar">
                    <p>Acertos: <span id="contador-acertos">0</span></p>
                    <p>Erros: <span id="contador-erros">0</span></p>
                </div>
                <button id="botao-reiniciar">Reiniciar a Partida</button>
            </div>
        </aside>

        <main class="area-trabalho">
            <div id="tabuleiro-quebra-cabeca">
            </div>
            <div id="container-pecas">
            </div>
        </main>
    </div>

    <footer>
        <div class="caixa-mensagem-mapa">
            <a href="mapa.html?seal_earned=4">Retornar ao Mapa Principal</a>
        </div>
    </footer>

    <div id="modal-boas-vindas" class="modal-info">
        <div class="conteudo-modal-info">
            <h2>Bem-vindo à Aventura!</h2>
            <p>Sua missão é recriar a imagem, colocando cada peça no seu devido lugar. Prepare-se para um desafio que testará sua atenção e raciocínio!</p>
            <h3>Regras do Jogo:</h3>
            <ul>
                <li>Arraste e Solte: Clique e arraste as peças da área inferior para os espaços vazios no tabuleiro principal.</li>
                <li>Encaixe Perfeito: Cada peça tem um lugar certo. Se a peça não se encaixar no espaço, ela não será fixada, e um "erro" será contabilizado.</li>
                <li>Imagem Guia: Use a imagem de referência na barra lateral para te ajudar a montar o quebra-cabeça.</li>
                <li>Pontuação: Seu placar de acertos e erros será atualizado. Tente minimizar os erros!</li>
                <li>Selo de Conquista: Complete o quebra-cabeça para ganhar um selo exclusivo e avançar em sua jornada!</li>
            </ul>
            <button id="botao-comecar-jogo" class="botao-fechar-modal">Começar Jogo</button>
        </div>
    </div>

    <div id="modal-conclusao" class="overlay-modal" style="display: none;">
        <div class="conteudo-modal">
            <h2>Você conseguiu!! Parabéns!!</h2>
            <p>Você concluiu com êxito a atividade!</p>
            <img src="HPERS.png" alt="Selo Conquistado" class="selo-ganho">
            <p>Clique no botão abaixo para voltar ao mapa e continuar sua jornada!</p>
            <a href="mapa.html?seal_earned=4" class="botao-voltar">Voltar ao Mapa</a>
        </div>
    </div>

    <audio id="som-aplauso" src="aplausos.mp3" preload="auto"></audio>
    <audio id="som-erro" src="erro.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- CONFIGURAÇÕES DO JOGO ---
            const LINHAS = 5;
            const COLUNAS = 8;
            const TOTAL_PECAS = LINHAS * COLUNAS;
            const NOME_IMAGEM_QUEBRA_CABECAS = 'onça.png'; // Caminho da imagem do quebra-cabeça (Ajustei para onça.png)
            const NOME_SELO_GANHO = 'HPERS.png'; // Imagem do selo que o jogador ganha
            const ID_SELO = '4'; // ID único para salvar no navegador para este selo (Perseverança)

            // Dimensões originais da imagem do quebra-cabeça.
            // VOCÊ DEVE SUBSTITUIR ESSES VALORES PELAS DIMENSÕES REAIS DA SUA IMAGEM 'onça.png'
            const ORIGINAL_IMAGE_WIDTH = 800; // Por exemplo, se 'onça.png' tem 800px de largura
            const ORIGINAL_IMAGE_HEIGHT = 500; // Por exemplo, se 'onça.png' tem 500px de altura

            // --- ELEMENTOS DO DOM ---
            const tabuleiro = document.getElementById('tabuleiro-quebra-cabeca');
            const containerPecas = document.getElementById('container-pecas');
            const contadorAcertosEl = document.getElementById('contador-acertos');
            const contadorErrosEl = document.getElementById('contador-erros');
            const botaoReiniciar = document.getElementById('botao-reiniciar');
            const modalConclusao = document.getElementById('modal-conclusao');
            const somAplauso = document.getElementById('som-aplauso');
            const modalBoasVindas = document.getElementById('modal-boas-vindas');
            const botaoComecarJogo = document.getElementById('botao-comecar-jogo');
            const somErro = document.getElementById('som-erro'); // Referência ao elemento de áudio de erro
            const playerAvatar = document.getElementById('playerAvatar'); // Referência ao avatar do jogador

            // --- ESTADO DO JOGO ---
            let acertos = 0;
            let erros = 0;
            let pecaArrastada = null;

            // --- FUNÇÕES PRINCIPAIS ---

            function inicializarJogo() {
                acertos = 0;
                erros = 0;
                atualizarPlacar();

                tabuleiro.innerHTML = '';
                containerPecas.innerHTML = '';
                modalConclusao.style.display = 'none';

                let pecas = [];
                for (let i = 0; i < TOTAL_PECAS; i++) {
                    const espaco = document.createElement('div');
                    espaco.classList.add('espaco-peca');
                    espaco.dataset.id = i;
                    tabuleiro.appendChild(espaco);

                    espaco.addEventListener('dragover', aoArrastarSobre);
                    espaco.addEventListener('drop', aoSoltar);

                    const peca = document.createElement('div');
                    peca.classList.add('peca-quebra-cabeca');
                    peca.dataset.id = i;
                    peca.draggable = true;

                    // Calcula a posição do background para cada pedaço da imagem
                    const col = i % COLUNAS;
                    const lin = Math.floor(i / COLUNAS);

                    // O background-size é o tamanho TOTAL da imagem, e o background-position
                    // é o deslocamento de cada pedaço dentro dessa imagem total.
                    peca.style.backgroundImage = `url('${NOME_IMAGEM_QUEBRA_CABECAS}')`;
                    peca.style.backgroundSize = `${ORIGINAL_IMAGE_WIDTH}px ${ORIGINAL_IMAGE_HEIGHT}px`;
                    peca.style.backgroundPosition = `-${col * (ORIGINAL_IMAGE_WIDTH / COLUNAS)}px -${lin * (ORIGINAL_IMAGE_HEIGHT / LINHAS)}px`;

                    peca.addEventListener('dragstart', aoArrastar);
                    pecas.push(peca);
                }

                pecas.sort(() => Math.random() - 0.5); // Embaralha as peças
                pecas.forEach(p => containerPecas.appendChild(p)); // Adiciona as peças ao container lateral

                // Chama para garantir que o background-size das peças (se necessário) seja ajustado
                // ou apenas para confirmar o layout após o carregamento.
                // Como agora background-size é fixo para a imagem original, esta função é menos crítica aqui.
                // No entanto, se o tabuleiro tiver um tamanho responsivo e a imagem de fundo precisar se esticar
                // para cobrir, esta função precisaria reajustar o backgroundSize.
                // Mas, com o ajuste de CSS para as peças, o JS pode se preocupar menos com isso.
                // Mantenha para fins de compatibilidade ou futuros ajustes.
                ajustarTamanhoDasPecasNoTabuleiro(); 
                updatePlayerAvatarStatus(); // Atualiza o avatar ao reiniciar o jogo
            }

            // Esta função ajusta o background-size das peças
            // para que a imagem de fundo preencha corretamente o espaço da peça,
            // que agora é controlado pelo CSS responsivo do tabuleiro.
            function ajustarTamanhoDasPecasNoTabuleiro() {
                const larguraTabuleiroAtual = tabuleiro.clientWidth;
                const alturaTabuleiroAtual = tabuleiro.clientHeight;

                const todasAsPecas = document.querySelectorAll('.peca-quebra-cabeca');
                todasAsPecas.forEach(p => {
                    // O background-size deve ser o tamanho total da imagem, escalado para o tamanho atual do tabuleiro
                    p.style.backgroundSize = `${larguraTabuleiroAtual}px ${alturaTabuleiroAtual}px`;
                    // O background-position já está correto, pois é calculado com base nas dimensões originais da imagem
                    // e o número de colunas/linhas, o que funciona bem com o escalamento do background-size.
                });
            }

            function atualizarPlacar() {
                contadorAcertosEl.textContent = acertos;
                contadorErrosEl.textContent = erros;
            }

            // --- LÓGICA DE ARRASTAR E SOLTAR (DRAG & DROP) ---

            function aoArrastar(evento) {
                pecaArrastada = evento.target;
                setTimeout(() => evento.target.style.opacity = '0.5', 0);
            }

            function aoArrastarSobre(evento) {
                evento.preventDefault();
            }

            function aoSoltar(evento) {
                evento.preventDefault();
                pecaArrastada.style.opacity = '1';
                const espacoAlvo = evento.target;

                // Verifica se o alvo é um espaço de peça e se está vazio
                if (espacoAlvo.classList.contains('espaco-peca') && !espacoAlvo.hasChildNodes()) {
                    if (pecaArrastada.dataset.id === espacoAlvo.dataset.id) {
                        // ACERTOU
                        espacoAlvo.appendChild(pecaArrastada);
                        pecaArrastada.draggable = false;
                        pecaArrastada.style.cursor = 'default';
                        acertos++;
                        verificarVitoria();
                    } else {
                        // ERROU - Toca o som de erro
                        erros++;
                        somErro.currentTime = 0;
                        somErro.play();
                    }
                    atualizarPlacar();
                } else {
                    // Se soltou em um lugar inválido (não é espaço de peça ou já tem peça)
                    erros++;
                    somErro.currentTime = 0;
                    somErro.play();
                    atualizarPlacar();
                }
            }

            // --- LÓGICA DE VITÓRIA E SELOS ---

            function verificarVitoria() {
                if (acertos === TOTAL_PECAS) {
                    somAplauso.play();
                    modalConclusao.style.display = 'flex';

                    // Adiciona o selo ao localStorage
                    let collectedSeals = JSON.parse(localStorage.getItem('collectedSeals')) || [];
                    if (!collectedSeals.includes(ID_SELO)) {
                        collectedSeals.push(ID_SELO);
                        localStorage.setItem('collectedSeals', JSON.stringify(collectedSeals));
                        console.log(`Selo ${ID_SELO} adicionado aos selos coletados.`); // DEBUG
                    } else {
                        console.log(`Selo ${ID_SELO} já está coletado.`); // DEBUG
                    }
                    updatePlayerAvatarStatus(); // Atualiza o avatar para refletir o selo ganho
                }
            }

            /**
             * Atualiza o status do avatar do jogador com base nos selos coletados.
             * Se o selo deste jogo foi coletado, adiciona a classe 'unlocked' ao avatar.
             */
            function updatePlayerAvatarStatus() {
                const collectedSeals = JSON.parse(localStorage.getItem('collectedSeals')) || [];
                if (collectedSeals.includes(ID_SELO)) {
                    playerAvatar.classList.add('unlocked');
                    console.log('Avatar atualizado: selo desbloqueado.'); // DEBUG
                } else {
                    playerAvatar.classList.remove('unlocked');
                    console.log('Avatar atualizado: selo não desbloqueado.'); // DEBUG
                }
            }

            // --- EVENTOS ---
            botaoReiniciar.addEventListener('click', () => {
                // Substituído alert() e confirm() por uma mensagem customizada
                const customConfirm = (message, onConfirm, onCancel) => {
                    const overlay = document.createElement('div');
                    overlay.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                        background-color: rgba(0,0,0,0.7); display: flex; justify-content: center;
                        align-items: center; z-index: 9999;
                    `;
                    const box = document.createElement('div');
                    box.style.cssText = `
                        background-color: white; padding: 25px; border-radius: 10px;
                        text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                        max-width: 350px; width: 90%;
                    `;
                    const msg = document.createElement('p');
                    msg.textContent = message;
                    msg.style.cssText = 'margin-bottom: 20px; font-size: 1.1em; color: #333;';

                    const btnContainer = document.createElement('div');
                    btnContainer.style.cssText = 'display: flex; justify-content: center; gap: 15px;';

                    const confirmBtn = document.createElement('button');
                    confirmBtn.textContent = 'Sim';
                    confirmBtn.style.cssText = `
                        padding: 10px 20px; border: none; border-radius: 5px;
                        background-color: #dc3545; color: white;
                        font-size: 1em; cursor: pointer; transition: background-color 0.3s;
                    `;
                    confirmBtn.onmouseover = () => confirmBtn.style.backgroundColor = '#c82333';
                    confirmBtn.onmouseout = () => confirmBtn.style.backgroundColor = '#dc3545';
                    confirmBtn.onclick = () => { document.body.removeChild(overlay); onConfirm(); };

                    const cancelBtn = document.createElement('button');
                    cancelBtn.textContent = 'Não';
                    cancelBtn.style.cssText = `
                        padding: 10px 20px; border: none; border-radius: 5px;
                        background-color: #007bff; color: white;
                        font-size: 1em; cursor: pointer; transition: background-color 0.3s;
                    `;
                    cancelBtn.onmouseover = () => cancelBtn.style.backgroundColor = '#0056b3';
                    cancelBtn.onmouseout = () => cancelBtn.style.backgroundColor = '#007bff';
                    cancelBtn.onclick = () => { document.body.removeChild(overlay); if (onCancel) onCancel(); };

                    btnContainer.appendChild(confirmBtn);
                    btnContainer.appendChild(cancelBtn);
                    box.appendChild(msg);
                    box.appendChild(btnContainer);
                    overlay.appendChild(box);
                    document.body.appendChild(overlay);
                };

                customConfirm('Tem certeza que deseja reiniciar a partida? Seu progresso nesta atividade será perdido.', () => {
                    inicializarJogo(); // Reinicia o jogo
                });
            });

            // Adiciona um listener para redimensionar as peças quando a janela muda de tamanho
            // Isso é crucial para a responsividade das peças de background.
            window.addEventListener('resize', ajustarTamanhoDasPecasNoTabuleiro);


            // Evento para fechar o modal de boas-vindas
            botaoComecarJogo.addEventListener('click', () => {
                modalBoasVindas.style.display = 'none';
                inicializarJogo(); // Inicia o jogo após fechar o modal
            });

            // --- INICIAR O JOGO QUANDO A PÁGINA CARREGAR ---
            // Exibe o modal de boas-vindas ao carregar
            modalBoasVindas.style.display = 'flex';
            // Atualiza o status do avatar na carga inicial
            updatePlayerAvatarStatus();
        });
    </script>
    </body>
</html>